{% extends 'base.html' %}
{% load static %}

{% block title %} property {% endblock title %}

{% block modal %}
<div aria-hidden="true" data-backdrop="static" class="onboarding-modal modal fade animated" id="add_admin_modal"
    role="dialog" tabindex="-1">
    <div class="modal-dialog modal-centered " role="document">
        <form method="POST" id='add_admin_form'>
            <div class="modal-content">
                <button aria-label="Close" class="close" data-dismiss="modal" type="button"><span
                        class="close-label">Close</span><span class="os-icon os-icon-close"></span></button>
                <div class="onboarding-slider-w tenant_slides">
                    <div class="onboarding-slide normal_slide">
                        <div class="onboarding-content with-gradient">
                            <h4 class="onboarding-title display-8 fancy_text5 lead text-left">
                                <span class="admin_name_title">Please wait</span></h4>
                            <hr>
                            {% comment %} <div class="row my-3">
                                <div class="profile  col-12 d-flex justify-content-center">
                                    <div class="profile-photo mt-0">
                                        <img src="https://ae01.alicdn.com/kf/HTB1ybcbSpXXXXaoapXXq6xXFXXXM/DIY-oil-painting-by-numbers-Sexy-Marilyn-Monroe-with-frame-hand-Paint-by-numbers-wall-creative.jpg_640x640.jpg"
                                            style="border:4px solid #d1b808" class="img-fluid rounded-circle"
                                            width="100px" alt="">
                                    </div>
                                </div>
                            </div> {% endcomment %}
                            {% include 'partials/_image.html' with name="image"  %}
                            <div class="row">
                                <div class="col-sm-12 ">
                                    <div class=" form-group ">
                                        <label for="" class="step-text">Full name</label>
                                        <input class="form-control required required-1"
                                            placeholder="Example: Mariga Waithera" type="text" id='name' name="name">
                                    </div>
                                </div>
                            </div>

                            {% comment %} <div class="row mt-3">
                                <div class="col-sm-12 ">
                                    <label for="" style="font-size:15px"
                                        class='text-left col-sm-12  fancy_text3 text-black '> <span
                                            class='fancy_text4 text-primary font-w600 image_text'>Upload a profile photo
                                        </span></label>
                                    <input type="file" name='photo' class="form-control-file btn btn-primary px-2 py-2"
                                        id="photo">
                                </div>
                            </div> {% endcomment %}
                        </div>
                    </div>



                    <div class="onboarding-slide credentials_slide">
                        <div class="onboarding-content with-gradient">
                            <h4 class="onboarding-title display-8 fancy_text4 lead text-left">Credentials</h4>
                            <hr>

                            <div class="  mb-5 col-12 bg-browns p-3">
                              
                                <div class="row">
                                    <div class="col-12">
                                        <div class="form-group"> <label for="">Enter a <span
                                                    class="font-w600">strong</span> password</label>
                                            <div class="input-group mb-2 mb-sm-0">
                                                <input class="form-control" placeholder="password" type="password"
                                                    name="password_credential1" id="password_credential1">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-12">
                                        <div class="form-group"> <label for="">Enter a <span
                                                    class="font-w600">strong</span> password</label>
                                            <div class="input-group mb-2 mb-sm-0">
                                                <input class="form-control" placeholder="password" type="password"
                                                    name="password_credential2" id="password_credential2">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="form-group required">
                                            <label class="control-label">User type</label>
                                            <select class="form-control" required="required" name="user_type"
                                                id="user_type">
                                                <option value="admin">Admin</option>
                                                <option value="staff">Staff</option>
                                            </select> </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="form-group required">
                                            <label class="control-label">Activate account?</label>
                                            <select class="form-control" required="required" name="is_active"
                                                id="is_active">
                                                <option value="True">Yes</option>
                                                <option value="False">No</option>

                                            </select> </div>
                                    </div>
                                </div>


                            </div>

                        </div>
                    </div>
                
                   
                    <div class="onboarding-slide ">
                        <div class="onboarding-content with-gradient">
                            <h4 class="onboarding-title display-8 fancy_text4 lead text-left">Contact info</h4>
                            <hr>
                            <div class="row ">
                                <div class="col-12">
                                    <div class="form-group"> <label class='' for="">Enter an email</label>
                                        <div class="input-group mb-2 mb-sm-0">
                                            <input class="form-control" placeholder="joseph@kakamkubwa.com"
                                                type="email" name="email" id="email">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row ">
                                <div class="col-12 col-12">
                                    <div class="form-group"> <label class='' for="">Phone number</label>
                                        <div class="input-group mb-2 mb-sm-0">
                                            <input class="form-control" placeholder="Enter phone number" type="text"
                                                name="phone_number" id="phone_number">
                                        </div>
                                    </div>
                                </div>
                            </div>
                           
                         
                          
                        </div>
                    </div>
                    <div class="onboarding-slide normal_slide">
                        <div class="onboarding-media">
                            {% comment %} <img alt="" src="{% static 'img/images/individual.webp' %}" width="80px"
                                height="80px"> {% endcomment %}

                        </div>
                        <div class="onboarding-content with-gradient">
                            <input type="hidden" id="action_type" name="action_type">
                            <input type="hidden" name="user_id" id="user_id">
                            <input type="hidden" name="admin_id" id="admin_id">
                            <h4 class="onboarding-title lead display-8 text-center">Are you done?</h4>
                            <div class="form-buttons-w d-flex flex-row justify-content-end">
                                <button class="btn btn-primary px-5 py-2 submit" type="submit" id="submit_admin">Upload
                                    records</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>



{% endblock modal %}
{% block content %}

<div class="content-body" style="min-height: 828px;">
    <!-- row -->
    <div class="container-fluid">
        <div class="card mx-3">
            <div class="card-header d-block mx-3 text-center">
                <h5 class="card-titles display-4 custom-card-title ">Users list</h5>
            </div>
        </div>
        <div class="row">
            <div class="col-xl-12">
                <div class="col-12">
                    <div class="card px-3">
                        <div class="table-extra my-2">
                            <div class="row my-4 mx-3 pt-47 d-flex justify-content-end">
                                <button class="btn btn-warning light  py-2 px-5 btn-rounded" type="button"
                                    id="add_admin_button"><span>Click to add</span></button>
                            </div>
                            {% comment %} <div class="row my-3 mx-4 pt-47 d-flex justify-content-start">
                                <h4 class="card-title"><span class="display-4 total_admin">Please wait</span> profiles
                                </h4>
                            </div> {% endcomment %}
                            <div class="row my-3 mx-4 pt-47 d-flex justify-content-start">

                                <h4 class="card-title  display-8"
                                    style="letter-spacing:1.6px;color: #7e7e7e!important;"><span
                                        class="display-4 total_admin fancy_text3">Please wait</span><span
                                        class="fancy_text4">
                                        users</span></h4>
                            </div>
                        </div>



                        <div class="card-body">
                            <div class="table-responsive">
                                <table id="admin_table" class="table verticle-middle table-responsive-md">
                                    
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Email</th>
                                            <th>Admin</th>
                                            <th>Status</th>
                                            <th> </th>
                                    </thead>
                                    <tbody>

                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>

{% block scripts %}
<script>
    $(document).on('click', '#add_admin_button', function () {
        $('#add_admin_form')[0].reset();
        $("#allocate_credentials").val("not_active").change();
        $('.admin_name_title').text("Add a profile");
        $("#action_type").val("add");
        $('#password_credential1').val("");
        $('#password_credential2').val("");
        $('.username_user').removeClass("d-none");
        $('#add_admin_modal').modal('show');
    });
    //Tenant--------------------------------------------------------------------------------------
    $(document).on('click', '.admin_delete', function () {
        var data = $(this).attr("id");
        var data_split = data.split(",");
        var profile = data_split[0];
        var name = data_split[1];
        var user = data_split[2];
        var role = data_split[3];
        $('#confirm_title').text("Just confirming...");
        $('#confirm_text').text("Confirming the removal of " + name + " as " + role + " . ");
        $('#confirm_extra').text("Do you really want to remove " + name + "?");
        $('#confirm_button').text("Confirm removal");
        $('#confirm_alert').modal('show');
        $('#confirmYes').one('click', function () {
            // var res_id = null;
            $.ajax({
                url: "{% url 'users:admin-rud' id=12345 %}".replace(/12345/, profile)
                    .toString(),
                method: "DELETE",
                dataType: "json",
                data: {
                    user: user,
                    profile: profile,
                },
                success: function (data) {
                    admin_table.ajax.reload();
                    $('#success_text').text("Profile removed.");
                    $('#confirm_alert').modal('hide');
                    $('#success_alert').modal('show');
                }
            });

        });
        $("#confirmNo").click(function () {
            $('#confirm_alert').modal('hide');
        });

    });

    $(document).on('click', '.admin_edit', function () {
        var id = $(this).attr("id");

        //$('.onboarding-modal .onboarding-slider-w').slick('slickGoTo', step);
        $('input.form-control').val("");
        $("#property_name").attr("readonly", false);

        $.ajax({
            url: "{% url 'users:admin-rud' id=12345 %}".replace(/12345/, id).toString(),
            method: "GET",
            dataType: "json",
            success: function (data) {

                $('.admin_name_title').text(data.profile.name);
                $('#admin_id').val(id);
                $('#name').val(data.profile.name);
                $('#user_id').val(data.profile.user);
                $('#email').val(data.email);
                $('#phone_number').val( data.profile.phone_number);
               
                $('#description').val( data.profile.description);
               
                $('#user_type').val( data.user_type).change();
                if (data.is_active == true) {
                    $('#is_active').val("True").change();
                } else {
                    $('#is_active').val("False").change();
                }

                $('#password_credential1').val("no_password");
                $('#password_credential2').val("no_password");
                $('.username_user').addClass("d-none");
                $('#imageUpload').attr("src", data.profile.image).change();
              
                $('#imagePreview').css('background-image', 'url(' + data.profile.image + ')');
                $("#action_type").val("edit");
                $('#add_admin_modal').modal('show');


            }
        })
    });
    var admin_table = $("#admin_table").DataTable({
        processing: true,
        serverSide: true,
        oLanguage: {
            sEmptyTable: "No user",
        },
        ajax: {
            url: '{% url "users:admin-listcreate" %}',

        },
        "fnDrawCallback": function () {
            //console.log(this.fnSettings().json.total_sum);
            $('.total_admin').text(this.fnSettings().fnRecordsTotal());
        }
    });
    $(document).on('submit', '#add_admin_form', function (event) {
        var action_type = $('#action_type').val();
        var admin = $('#admin_id').val();
        if (action_type == 'add') {
            var method = 'POST';
            var url = '{% url "users:admin-listcreate" %}';
        }
        if (action_type == 'edit') {
            var method = 'PUT';
            var url = "{% url 'users:admin-rud' id=12345 %}".replace(/12345/, admin).toString();
        }

        var form_data = new FormData(this);

        event.preventDefault();
        $.ajax({
            method: method,
            url: url,
            data: form_data,
            contentType: false,
            processData: false,
            dataType: "json",
            beforeSend: function () {
                $('#submit_admin').attr('disabled', 'disabled');
                $("#submit_admin").html("Please wait");
            },
            success: function (data) {

                $('#submit_admin').attr('disabled', false);
                $("#submit_admin").html("Upload records");
                if (data.error) {
                    $('#oops_text').text(data.error);
                    $('#oops_alert').modal('show');
                }
                if (data.success) {
                    //$('.onboarding-modal .income_slick_modal').slick('slickGoTo', 0);

                    $('#success_text').text(data.success);
                    $('#success_alert').modal('show');
                    admin_table.ajax.reload();
                    $('#add_admin_modal').modal('hide');
                }
            },
            error: function (error) {

                $('#submit_admin').attr('disabled', false);
                $("#submit_admin").html("Upload records");
                $('#oops_text').text("Something went wrong, try again later");
                $('#oops_alert').modal('show');
            }
        });
    });
</script>
{% endblock scripts %}
{% endblock content %}


<!--**********************************
    Content body end
***********************************-->